import { FC, useState } from "react";
import { Channel } from "../redux/slicers";
import { Socket } from "socket.io-client";
import { Button, Tooltip } from "flowbite-react";
import { FaX } from "react-icons/fa6";
import { UserComponent } from "./user.component";

export const ChannelComponent: FC<Channel & { socket: Socket, chosen: boolean }> = ({
	channel,
	users,
	messages,
	joinsAndLeaves,
	socket,
	joined,
	chosen,
}) => {
	if (!chosen) return;
	const [leaving, setLeaving] = useState(false);
	const handleLeaveChannel = () => {
		socket
			.emitWithAck("cmd", { cmd: "leave", args: [channel] })
			.then((left: boolean) => {
				setLeaving(false);
				if (!left) return;
			});
	};
	return joined ? (
		<div className="dark:text-white h-full min-w-full flex flex-col gap-2 border border-black dark:border-white rounded divide-y">
			<div className="flex gap-2 p-2">
				<div className="font-bold m-auto grow">{channel}</div>
				<Tooltip content="Leave channel">
					<Button
						isProcessing={leaving}
						pill
						outline
						onClick={handleLeaveChannel}
						size="xs"
					>
						<FaX />
					</Button>
				</Tooltip>
			</div>
			<div className="flex divide-x h-full">
				<div className="grow p-2">Chat here</div>
				<div className="p-2 min-w-[20%] flex flex-col gap-2">
					{users.map(username => (
						<UserComponent username={username} />
					))}
				</div>
			</div>
		</div>
	) : null;
};
